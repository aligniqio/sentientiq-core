CREATE DATABASE IF NOT EXISTS sentientiq;

-- processed social posts (Parquet)
CREATE EXTERNAL TABLE IF NOT EXISTS sentientiq.social_processed (
  post_id string,
  platform string,
  author_id string,
  author_handle string,
  brand string,
  topic array<string>,
  lang string,
  created_at timestamp,
  ingested_at timestamp,
  text string,
  dedupe_key string,
  is_duplicate boolean,
  bot_score double,
  authenticity double,
  emotion_primary string,
  emotion_scores map<string,double>,
  engagement_count bigint,
  fingerprint string,
  source_url string
)
PARTITIONED BY (platform_part string, brand_part string, ingest_date string)
STORED AS PARQUET
LOCATION 's3://sentientiq-processed-data/social/'
TBLPROPERTIES ('parquet.compression'='SNAPPY');

MSCK REPAIR TABLE sentientiq.social_processed;

-- EVI time series
CREATE EXTERNAL TABLE IF NOT EXISTS sentientiq.evi_ts (
  ts timestamp,
  brand string,
  topic string,
  evi double,
  intensity double,
  velocity double,
  authenticity_mean double,
  engagement_rate double,
  consensus double,
  window_seconds int
)
PARTITIONED BY (agent string, dt string)
STORED AS PARQUET
LOCATION 's3://sentientiq-data-moat/evi_ts/';

MSCK REPAIR TABLE sentientiq.evi_ts;
