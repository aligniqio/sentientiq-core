<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SentientIQ GTM Test Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .test-area {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            min-height: 200px;
        }
        .price-box {
            display: inline-block;
            background: white;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .price-box:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .cta-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }
        .cta-button:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        .console-output {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .emotion-display {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .emotion-badge {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        .instructions {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ SentientIQ GTM Integration Test Page</h1>

        <div class="instructions">
            <h3>üìã Testing Instructions:</h3>
            <ol>
                <li>Open Developer Console (F12)</li>
                <li>Look for [SentientIQ] messages</li>
                <li>Interact with the elements below</li>
                <li>Check for emotion detection and intervention triggers</li>
            </ol>
        </div>

        <div id="status-panel">
            <h2>System Status</h2>
            <div id="detection-status" class="status pending">‚è≥ Detection Script: Loading...</div>
            <div id="intervention-status" class="status pending">‚è≥ Intervention Script: Loading...</div>
            <div id="tenant-status" class="status pending">‚è≥ Tenant Configuration: Checking...</div>
        </div>

        <div class="test-area">
            <h2>üéØ Interaction Test Area</h2>
            <p>Interact with these elements to trigger emotion detection:</p>

            <div class="price-box">
                <h3>Premium Plan</h3>
                <div style="font-size: 24px; font-weight: bold; color: #28a745;">$4,997/mo</div>
                <p>Hover to trigger high_consideration</p>
            </div>

            <div class="price-box">
                <h3>Starter Plan</h3>
                <div style="font-size: 24px; font-weight: bold; color: #007bff;">$497/mo</div>
                <p>Hover to trigger interest</p>
            </div>

            <button class="cta-button">Sign Up Now</button>
            <button class="cta-button">Request Demo</button>

            <p style="margin-top: 30px;">
                <strong>Behavior Triggers:</strong><br>
                ‚Ä¢ Move mouse to top of window ‚Üí Exit Intent<br>
                ‚Ä¢ Scroll rapidly up/down ‚Üí Confusion<br>
                ‚Ä¢ Click repeatedly on same element ‚Üí Frustration<br>
                ‚Ä¢ Hover on prices ‚Üí High Consideration
            </p>
        </div>

        <div class="emotion-display">
            <h3>üé≠ Current Emotions</h3>
            <div id="emotions-container">Waiting for emotion data...</div>
        </div>

        <div class="console-output" id="console-output">
            <div>SentientIQ Console Monitor</div>
            <div>==========================</div>
        </div>

        <h2>üìä Quick Checks</h2>
        <button onclick="checkSystem()">Check System Status</button>
        <button onclick="getEmotions()">Get Current Emotions</button>
        <button onclick="checkLocalStorage()">Check LocalStorage</button>
        <button onclick="findScripts()">Find Loaded Scripts</button>
        <button onclick="simulateExitIntent()">Simulate Exit Intent</button>
    </div>

    <!-- Inline GTM Script for Testing -->
    <script>
    (function() {
      if (window.SentientIQ_loaded) return;
      window.SentientIQ_loaded = true;

      // Configuration
      var TENANT_ID = 'sidk';
      var API_KEY = 'sq_live_sidk_test';
      var API_ENDPOINT = 'https://api.sentientiq.app';

      // Initialize SentientIQ namespace
      window.SentientIQ = window.SentientIQ || {};
      window.SentientIQ.config = {
        tenantId: TENANT_ID,
        apiKey: API_KEY,
        apiEndpoint: API_ENDPOINT,
        debug: true
      };

      // Store in localStorage
      localStorage.setItem('tenantId', TENANT_ID);
      localStorage.setItem('apiKey', API_KEY);
      localStorage.setItem('apiEndpoint', API_ENDPOINT);

      function loadScript(src, onLoad) {
        var script = document.createElement('script');
        script.src = src;
        script.async = true;
        if (onLoad) script.onload = onLoad;
        script.onerror = function() {
          console.error('[SentientIQ] Failed to load script:', src);
          log('‚ùå Failed to load: ' + src, 'error');
        };
        document.head.appendChild(script);
      }

      // Load detection script
      log('üöÄ Loading detection script...');
      loadScript(
        'http://localhost:3001/detect-v4.js?tenant=' + TENANT_ID + '&key=' + API_KEY,
        function() {
          log('‚úÖ Detection script loaded');
          document.getElementById('detection-status').className = 'status success';
          document.getElementById('detection-status').textContent = '‚úÖ Detection Script: Loaded';

          if (window.SentientIQ && window.SentientIQ.getEmotionHistory) {
            window.SentientIQ.emotions = window.SentientIQ.getEmotionHistory;
            log('‚úÖ Emotion tracking initialized');
          }

          // Load interventions
          setTimeout(function() {
            log('üöÄ Loading interventions script...');

            if (!window.SentientIQ.config) {
              window.SentientIQ.config = {
                tenantId: TENANT_ID,
                apiKey: API_KEY,
                apiEndpoint: API_ENDPOINT
              };
            }

            loadScript(
              'http://localhost:3001/interventions-v4.js?tenant=' + TENANT_ID + '&key=' + API_KEY,
              function() {
                log('‚úÖ Interventions script loaded');
                document.getElementById('intervention-status').className = 'status success';
                document.getElementById('intervention-status').textContent = '‚úÖ Intervention Script: Loaded';

                if (window.SentientIQ && window.SentientIQ.interventions) {
                  log('üéâ Full system initialized!');
                  checkTenantConfig();
                }
              }
            );
          }, 100);
        }
      );
    })();

    // Logging helper
    function log(message, type = 'info') {
        const output = document.getElementById('console-output');
        const timestamp = new Date().toLocaleTimeString();
        const line = document.createElement('div');
        line.textContent = `[${timestamp}] ${message}`;
        if (type === 'error') line.style.color = '#ff6b6b';
        if (type === 'success') line.style.color = '#51cf66';
        output.appendChild(line);
        output.scrollTop = output.scrollHeight;
        console.log('[Test Page]', message);
    }

    // Check functions
    function checkSystem() {
        log('=== System Check ===', 'success');
        if (window.SentientIQ) {
            log('‚úÖ SentientIQ object exists');
            log('Config: ' + JSON.stringify(window.SentientIQ.config, null, 2));
            log('Emotions function: ' + (typeof window.SentientIQ.emotions));
            log('Interventions: ' + (typeof window.SentientIQ.interventions));
        } else {
            log('‚ùå SentientIQ not initialized', 'error');
        }
    }

    function getEmotions() {
        log('=== Fetching Emotions ===', 'success');
        if (window.SentientIQ && window.SentientIQ.emotions) {
            const emotions = window.SentientIQ.emotions();
            log('Emotions: ' + JSON.stringify(emotions));
            updateEmotionDisplay(emotions);
        } else if (window.SentientIQ && window.SentientIQ.getEmotionHistory) {
            const emotions = window.SentientIQ.getEmotionHistory();
            log('Emotions: ' + JSON.stringify(emotions));
            updateEmotionDisplay(emotions);
        } else {
            log('‚ùå Emotion tracking not available', 'error');
        }
    }

    function updateEmotionDisplay(emotions) {
        const container = document.getElementById('emotions-container');
        if (!emotions || emotions.length === 0) {
            container.innerHTML = '<em>No emotions detected yet. Interact with the page!</em>';
            return;
        }

        const emotionCounts = {};
        emotions.forEach(e => {
            emotionCounts[e.emotion] = (emotionCounts[e.emotion] || 0) + 1;
        });

        const html = Object.entries(emotionCounts)
            .map(([emotion, count]) => {
                const color = getEmotionColor(emotion);
                return `<span class="emotion-badge" style="background: ${color}; color: white;">
                    ${emotion} (${count})
                </span>`;
            })
            .join('');

        container.innerHTML = html;
    }

    function getEmotionColor(emotion) {
        const colors = {
            curiosity: '#007bff',
            interest: '#28a745',
            confusion: '#ffc107',
            frustration: '#dc3545',
            abandonment_risk: '#6c757d',
            high_consideration: '#6610f2',
            delight: '#20c997',
            anticipation: '#fd7e14',
            satisfaction: '#198754',
            engagement: '#0dcaf0'
        };
        return colors[emotion] || '#6c757d';
    }

    function checkLocalStorage() {
        log('=== LocalStorage Check ===', 'success');
        log('Tenant ID: ' + localStorage.getItem('tenantId'));
        log('API Key: ' + localStorage.getItem('apiKey'));
        log('API Endpoint: ' + localStorage.getItem('apiEndpoint'));
    }

    function findScripts() {
        log('=== Loaded Scripts ===', 'success');
        const scripts = document.querySelectorAll('script[src*="sentientiq"]');
        scripts.forEach(script => {
            log('Found: ' + script.src);
        });
        if (scripts.length === 0) {
            log('‚ùå No SentientIQ scripts found', 'error');
        }
    }

    function checkTenantConfig() {
        const tenantId = window.SentientIQ?.config?.tenantId;
        if (tenantId) {
            document.getElementById('tenant-status').className = 'status success';
            document.getElementById('tenant-status').textContent = `‚úÖ Tenant Configuration: ${tenantId}`;
            log(`‚úÖ Tenant configured: ${tenantId}`, 'success');
        } else {
            document.getElementById('tenant-status').className = 'status error';
            document.getElementById('tenant-status').textContent = '‚ùå Tenant Configuration: Missing';
        }
    }

    function simulateExitIntent() {
        log('üéØ Simulating exit intent...', 'success');
        const event = new MouseEvent('mouseout', {
            view: window,
            bubbles: true,
            cancelable: true,
            clientY: -1
        });
        document.dispatchEvent(event);
        log('Exit intent event dispatched');
    }

    // Auto-refresh emotions every 2 seconds
    setInterval(function() {
        if (window.SentientIQ && (window.SentientIQ.emotions || window.SentientIQ.getEmotionHistory)) {
            const emotions = window.SentientIQ.emotions ?
                window.SentientIQ.emotions() :
                window.SentientIQ.getEmotionHistory();
            updateEmotionDisplay(emotions);
        }
    }, 2000);

    // Initial check after page load
    window.addEventListener('load', function() {
        setTimeout(checkSystem, 1000);
    });
    </script>
</body>
</html>