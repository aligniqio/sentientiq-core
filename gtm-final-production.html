<script>
// SentientIQ v4 - Backend-Driven Intelligence System
// Sensor + Intervention Receiver
(function() {
  'use strict';

  // Prevent duplicate loading
  if (window.SentientIQ_loaded) return;
  window.SentientIQ_loaded = true;

  // Configuration from GTM variables
  var TENANT_ID = '{{Tenant ID}}';
  var API_KEY = '{{API Key}}';

  // Store configuration for scripts
  window.SentientIQ = {
    tenantId: TENANT_ID,
    apiKey: API_KEY,
    apiEndpoint: 'https://api.sentientiq.app',
    wsEndpoint: 'wss://api.sentientiq.app/ws'
  };

  // Store in localStorage for persistence
  localStorage.setItem('tenantId', TENANT_ID);
  localStorage.setItem('apiKey', API_KEY);

  console.log('üöÄ SentientIQ v4 Initializing...');
  console.log('Tenant:', TENANT_ID);
  console.log('Mode: Backend-Driven Intelligence');

  // Load emotion detection sensor
  var sensor = document.createElement('script');
  sensor.src = 'https://sentientiq.ai/detect-v4.js';
  sensor.async = true;
  sensor.onload = function() {
    console.log('‚úÖ Emotion sensor loaded');
  };
  sensor.onerror = function() {
    console.error('‚ùå Failed to load emotion sensor');
  };

  // Load intervention receiver (WebSocket client)
  var receiver = document.createElement('script');
  receiver.src = 'https://sentientiq.ai/intervention-receiver.js';
  receiver.async = true;
  receiver.onload = function() {
    console.log('‚úÖ Intervention receiver loaded');
  };
  receiver.onerror = function() {
    console.error('‚ùå Failed to load intervention receiver');
  };

  // Append scripts to document
  document.head.appendChild(sensor);
  document.head.appendChild(receiver);

  console.log('üß† Backend pattern engine: Active');
  console.log('üì° WebSocket interventions: Ready');

})();
</script>